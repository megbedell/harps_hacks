WOBBLE

developed by:
Megan Bedell (mbedell@oddjob.uchicago.edu)
David Hogg (david.hogg@nyu.edu)

This document is a record of experiments I have tried while developing the code.

BACKGROUND

The goal of wobble is to derive precise radial velocities from HARPS data. The HARPS data reduction software (DRS) automatically produces RVs which are derived by cross-correlation of the
stellar spectrum with a binary mask. Each echelle order has its own cross-correlation function (CCF), and the CCFs are co-added and fit with a Gaussian to produce a final RV. It's not
immediately obvious that this is the optimal way to get RVs, so I am experimenting with other methods. Additionally, the HARPS DRS is proprietary and somewhat black-box in function, and
an open-source alternative pipeline would be of great value to near-future RV instruments.

Here is a summary of the data products returned by the HARPS pipeline for a single observation: 
- a CCF fits file: 161 x 73 array containing the cross-correlation functions for each of the 72 echelle orders, plus a co-added CCF of all orders (apparently excluding the first order for unknown reasons). Order indices 57, 66, and 71 are blank. 
- an S1D fits file: 1-dimensional extracted spectrum which has been corrected for barycentric motion and rebinned to 0.1 Ang steps. 
- an E2DS fits file: 4096 x 72 array containing the extracted order-by-order spectrum. 
- header information: Within the header of each FITS file is a lot more information, including wavelength solution coefficients, spectral extraction parameters, order SNRs, barycentric correction values, and the RV drift solution from the simultaneous reference source (if applicable). 
Also returned are flatfield, blaze, wavelength solution, and localization FITS frames (one per nightly calibration).

Some useful links to documentation:
https://www.eso.org/sci/facilities/lasilla/instruments/harps/doc/DRS.pdf
https://www.eso.org/sci/facilities/lasilla/instruments/harps/doc/manual/userman2_1.pdf

RE-FITTING CCFS

The first thing we tried was playing around with the extraction of RV values from the DRS-returned CCFs. The DRS fits a single Gaussian to the co-added CCF, using all 161 points in the
fit (which includes a considerable amount of ``continuum''). I tried fitting Gaussians to each order's CCF and to the co-added CCF using varying numbers of points. Plotting the resulting
standard deviation among a time series of 48 measurements of an RV-quiet star as a function of how many points were used in the Gaussian fit showed that using 20 points on either side of
the minimum gives the lowest RV dispersion, so this was adopted for all subsequent Gaussian fits to the CCFs.

We also tried doing a simple parabolic interpolation rather than a Gaussian fit. This gave worse results in terms of RV dispersion regardless of how many CCF points were used in the fit.

The code to do these fitting experiments is currently located in read_harps.rv_parabola_fit, read_harps.rv_gaussian_fit.

COMBINING ORDERS

Some simple alternatives to adopting the RV of the co-added CCF are taking a (weighted or unweighted) mean or median of the RVs for each echelle order. We tested these methods using the
standard deviation of RVs for a time series of RV-quiet star observations as a quality metric, as before. The results indicate that weighting by abs(amplitude of the Gaussian) works
best, followed by weighting by amplitude**2, and both work better than non-weighted statistics. However, using the co-added CCF still performs marginally better than any other method we
tried!

PCA/SVD



OBSERVING CONDITIONS



WAVELENGTH SOLUTION

